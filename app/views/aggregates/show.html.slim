- breadcrumb :aggregate, @aggregate
- page_header_content_for @aggregate

ruby:
 after_controls = Workgroup.compliance_control_sets_for_workgroup.map do |key, label|
   TableBuilderHelper::Column.new(
     name: label,
     attribute: lambda do |item|
       ccs = @aggregate.compliance_check_set(key)
       ccs ? operation_status(ccs.status, verbose: true) : '-'
     end,
     sortable: false,
     link_to: lambda do |item|
       ccs = @aggregate.compliance_check_set(key)
       ccs && [@aggregate.workgroup, ccs]
    end
    )
  end

.page_content
  .container-fluid
    .row
      .col-lg-6.col-md-6.col-sm-12.col-xs-12
        = simple_block_for @aggregate, title: t('aggregate.form.sections.informations') do |d|
					= d.attribute :referentials, value: @aggregate.referentials.map{ |r| decorate_referential_name(r) }.join(', ').html_safe
					= d.attribute :status, value: operation_status(@aggregate.status, verbose: true, i18n_prefix: "aggregates.statuses")
					= d.attribute :new, as: :association, link: ->(new) { referential_path(new) }
					= d.attribute :contains_urgent_offer, value: boolean_icon(@aggregate.contains_urgent_offer?)
      = processing_helper(@aggregate)

    - if @aggregate.resources.any?
      .col-lg-12
        = table_builder_2 @aggregate.resources,
          [ \
            TableBuilderHelper::Column.new( \
              name: Aggregate::Resource.tmf(:workbench_name), \
              attribute: Proc.new {|item| item.workbench_name }, \
              sortable: false, \
            ), \
            TableBuilderHelper::Column.new( \
              name: Aggregate::Resource.tmf(:referential_creation_date), \
              attribute: Proc.new {|item| item.referential_creation_date }, \
              sortable: false, \
            ), \
            TableBuilderHelper::Column.new( \
              name: Aggregate::Resource.tmf(:priority), \
              attribute: Proc.new {|item| item.priority }, \
              sortable: false, \
            ), \
            TableBuilderHelper::Column.new( \
              name: Aggregate::Resource.tmf(:duration), \
              attribute: Proc.new {|item| item.duration }, \
              sortable: false, \
            ), \
            TableBuilderHelper::Column.new( \
              name: Aggregate::Resource.tmf(:metrics), \
              attribute: Proc.new { |item| decorated_metrics(item.metrics) }, \
              sortable: false, \
            )\
          ], cls: 'table'

    - if @aggregate.new
      .col-lg-12
        = table_builder_2 Referential.where(id: @aggregate.new),
          [ \
            TableBuilderHelper::Column.new( \
              name: @aggregate.class.tmf(:new), \
              attribute: 'name', \
              sortable: false, \
              link_to: lambda do |item| \
                referential_path(item) \
              end \
            ), *after_controls \
          ], cls: 'table'